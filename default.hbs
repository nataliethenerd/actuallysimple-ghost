<!DOCTYPE html>
<html lang="{{@site.locale}}">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {{!-- Site icon --}}
    {{#if @site.icon}}
    <link rel="icon" type="image/png" href="{{@site.icon}}" />
    {{/if}}

    {{!-- Open Graph meta tags --}}
    <meta property="og:site_name" content="{{@site.title}}" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="{{#if @site.og_title}}{{@site.og_title}}{{else}}{{@site.title}}{{/if}}" />
    <meta property="og:description" content="{{#if @site.og_description}}{{@site.og_description}}{{else}}{{@site.description}}{{/if}}" />
    <meta property="og:url" content="{{@site.url}}" />
    {{#if @site.og_image}}
    <meta property="og:image" content="{{@site.og_image}}" />
    {{else if @site.cover_image}}
    <meta property="og:image" content="{{@site.cover_image}}" />
    {{/if}}

    {{!-- Twitter meta tags --}}
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{{#if @site.og_title}}{{@site.og_title}}{{else}}{{@site.title}}{{/if}}" />
    <meta name="twitter:description" content="{{#if @site.og_description}}{{@site.og_description}}{{else}}{{@site.description}}{{/if}}" />
    {{#if @site.twitter_image}}
    <meta name="twitter:image" content="{{@site.twitter_image}}" />
    {{else if @site.og_image}}
    <meta name="twitter:image" content="{{@site.og_image}}" />
    {{else if @site.cover_image}}
    <meta name="twitter:image" content="{{@site.cover_image}}" />
    {{/if}}
    {{#if @site.twitter}}
    <meta name="twitter:site" content="{{@site.twitter}}" />
    {{/if}}

    <link rel="stylesheet" href="{{asset "built/index.css"}}" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">
    <script src="{{asset "built/index.js"}}" defer></script>

    <title>{{meta_title}}</title>

    <style>
        {{!-- Ghost accent color support --}}
        {{#if @site.accent_color}}
        :root {
            --ghost-accent-color: {{@site.accent_color}};
        }
        {{/if}}

        /* Default to Monospace styling */
        :root {
            --content-font-family: var(--font-mono);
            --heading-font-family: var(--font-mono);
            --content-font-size: var(--font-size-medium);
        }
        body { font-size: var(--font-size-medium); }
        .post-content { font-size: var(--post-content-size-medium); }
        .post-content h1 { font-size: 20px; }
        .post-content h2 { font-size: 18px; }
        .post-content h3 { font-size: 16px; }
        .post-content h4, .post-content h5, .post-content h6 { font-size: 14px; }
        .post-content code { font-size: 12px; }
        .post-content figcaption { font-size: 11px; }
        .post-item-thumbnail { height: 110px; }

        .site-title {
            font-family: var(--heading-font-family);
            font-size: 25px;
        }

        /* Header font customization */
        .header-font-monospace {
            --heading-font-family: var(--font-mono);
        }

        .header-font-sans-serif {
            --heading-font-family: var(--font-sans);
        }

        .header-font-serif {
            --heading-font-family: var(--font-serif);
        }

        /* Image zoom modal */
        .image-zoom-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            cursor: zoom-out;
        }

        .image-zoom-overlay img {
            max-width: 95%;
            max-height: 95%;
            object-fit: contain;
            border: none;
            filter: none;
        }

        .post-content img {
            cursor: zoom-in;
        }

    </style>

    {{!-- Site-wide code injection (head) --}}
    {{{@site.codeinjection_head}}}

    {{ghost_head}}
</head>
<body class="{{body_class}} sidebar-right font-monospace {{#match @custom.header_font "Monospace"}}header-font-monospace{{/match}}{{#match @custom.header_font "Sans-serif"}}header-font-sans-serif{{/match}}{{#match @custom.header_font "Serif"}}header-font-serif{{/match}}">
    <div class="container">
        <header class="site-header">
            <h1 class="site-title">
                <a href="{{@site.url}}">{{@site.title}}</a>
            </h1>

            <nav class="site-nav">
                {{navigation}}
                <a href="{{@site.url}}/rss/">RSS</a>
                <button class="theme-toggle" id="theme-toggle" onclick="toggleDarkMode()" title="Toggle dark mode">
                    <i class="ri-sun-line theme-icon"></i>
                </button>
            </nav>
        </header>

        <div class="site-content">
            <main class="site-main">
                {{{body}}}
            </main>

            <aside class="sidebar">
                {{#if @custom.show_about_me}}
                <div class="sidebar-widget sidebar-about">
                    <h3 class="sidebar-title">About</h3>
                    <div class="sidebar-divider">..........................................................................................................</div>
                    <div class="sidebar-about-content">
                        {{#if @custom.about_me_image}}
                        <div class="sidebar-about-image {{#match @custom.about_me_image_style "Circle"}}image-circle{{else}}image-default{{/match}}">
                            <img src="{{@custom.about_me_image}}" alt="{{@site.title}}" />
                        </div>
                        {{else if @site.cover_image}}
                        <div class="sidebar-about-image {{#match @custom.about_me_image_style "Circle"}}image-circle{{else}}image-default{{/match}}">
                            <img src="{{@site.cover_image}}" alt="{{@site.title}}" />
                        </div>
                        {{/if}}

                        {{#if @custom.about_me_text}}
                        <p>{{@custom.about_me_text}}</p>
                        {{else if @site.description}}
                        <p>{{@site.description}}</p>
                        {{else}}
                        <p>Welcome to my blog where I share thoughts, ideas, and insights on various topics. Thanks for stopping by!</p>
                        {{/if}}

                    </div>
                </div>
                {{/if}}




                {{#if @site.members_enabled}}
                <div class="sidebar-widget">
                    <h3 class="sidebar-title">Stay in the loop</h3>
                    <div class="sidebar-divider">..........................................................................................................</div>
                    <div class="sidebar-newsletter">
                        <p>Subscribe to get the latest posts sent to your email.</p>
                        <form class="sidebar-newsletter-form" data-members-form>
                            <input type="email" data-members-email placeholder="your@email.com" required />
                            <button type="submit">Subscribe</button>
                        </form>
                        <div class="message-success">Thanks! Check your email.</div>
                        <div class="message-error">Please enter a valid email.</div>
                    </div>
                </div>
                {{/if}}


                <div class="sidebar-widget">
                    <h3 class="sidebar-title">Tags</h3>
                    <div class="sidebar-divider">..........................................................................................................</div>
                    <div class="sidebar-tags">
                        {{#get "tags" limit="20" order="count.posts desc"}}
                        {{#foreach tags}}
                        <a href="{{url}}" class="sidebar-tag">{{name}}</a>
                        {{/foreach}}
                        {{/get}}
                    </div>
                </div>



            </aside>
        </div>

        <footer class="site-footer">
            <p>&copy; {{date format="YYYY"}} {{@site.title}}. Theme <a href="https://github.com/nataliethenerd/actuallysimple-ghost" target="_blank" rel="noopener">Actually Simple</a>.</p>
        </footer>
    </div>

    <!-- Image zoom modal -->
    <div class="image-zoom-overlay" id="imageZoomOverlay">
        <img src="" alt="" id="zoomedImage">
    </div>

    <script>
        // Dark mode functionality
        function toggleDarkMode() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);

            // Update button icon
            const toggleButton = document.getElementById('theme-toggle');
            const themeIcon = toggleButton ? toggleButton.querySelector('.theme-icon') : null;
            if (themeIcon) {
                themeIcon.className = newTheme === 'dark' ? 'ri-moon-line theme-icon' : 'ri-sun-line theme-icon';
            }
        }

        // Initialize theme on page load
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);

            const toggleButton = document.getElementById('theme-toggle');
            const themeIcon = toggleButton ? toggleButton.querySelector('.theme-icon') : null;
            if (themeIcon) {
                themeIcon.className = savedTheme === 'dark' ? 'ri-moon-line theme-icon' : 'ri-sun-line theme-icon';
            }
        })();

        // Open newsletter portal
        function openNewsletterPortal() {
            // Try portal API first
            if (window.ghost && window.ghost.portal) {
                window.ghost.portal.open({
                    page: 'signup'
                });
                return;
            }

            // Fallback to hash navigation
            window.location.hash = '#/portal/signup';
        }

        // Subscribe button feedback - inline version
        function addSubscribeButtonFeedback() {
            // Handle clicks on subscribe buttons
            document.addEventListener('click', function(e) {
                const button = e.target;

                // Check if it's a subscribe/newsletter button
                if (button.classList.contains('subscribe-button') ||
                    button.classList.contains('newsletter-button') ||
                    (button.type === 'submit' && button.closest('.sidebar-newsletter-form'))) {

                    console.log('Button clicked:', button);

                    // Prevent if already processing
                    if (button.classList.contains('loading') || button.classList.contains('success')) {
                        return;
                    }

                    // Add loading state
                    button.classList.add('loading');
                    button.disabled = true;

                    // After 1.5 seconds, show success
                    setTimeout(function() {
                        button.classList.remove('loading');
                        button.classList.add('success');
                        button.disabled = false;

                        // Reset after 3 seconds
                        setTimeout(function() {
                            button.classList.remove('success');
                        }, 3000);
                    }, 1500);
                }
            });
        }

        // Initialize subscribe button feedback
        addSubscribeButtonFeedback();

        // Image zoom functionality
        function initImageZoom() {
            const overlay = document.getElementById('imageZoomOverlay');
            const zoomedImage = document.getElementById('zoomedImage');
            const postImages = document.querySelectorAll('.post-content img');

            // Add click event to all post images
            postImages.forEach(function(img) {
                img.addEventListener('click', function(e) {
                    e.preventDefault();

                    // Set the zoomed image source and alt text
                    zoomedImage.src = this.src;
                    zoomedImage.alt = this.alt;

                    // Show the overlay
                    overlay.style.display = 'flex';

                    // Prevent body scroll
                    document.body.style.overflow = 'hidden';
                });
            });

            // Close zoom when clicking on overlay
            overlay.addEventListener('click', function() {
                overlay.style.display = 'none';
                document.body.style.overflow = 'auto';
            });

            // Close zoom with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && overlay.style.display === 'flex') {
                    overlay.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
        }

        // Initialize image zoom
        initImageZoom();
    </script>

    {{!-- Site-wide code injection (foot) --}}
    {{{@site.codeinjection_foot}}}

    {{ghost_foot}}
</body>
</html>
